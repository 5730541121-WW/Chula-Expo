<!-- Libery -->
<link rel="import" href="/public/lib/polymer/polymer.html">
<!-- Web Component -->
<link rel="import" href="/public/lib/iron-ajax/iron-ajax.html">

<dom-module id="zone-api">
  <template>
    <iron-ajax
      auto
      id="zoneResource"
      url="/api/zones"
      params="{{params}}"
      on-response="_handleResponse"
      headers="{{headers}}"
      handle-as="json"
      debounce-duration="300"
    ></iron-ajax>
  </template>
  <script>
    Polymer({
      is: 'zone-api',
      properties: {
        params: {
          type: Object,
          value: {
            fields: 'nameEN,thumbnail,shortNameEN,type',
            limit: 0,
            skip: 0
          }
        },
        headers: {
          type: Object,
          value: {
            Authorization: document.querySelector('chulaexpo-staff-app').token
          }
        },
        page: {
          type: Number
        },
        pageSize: {
          type: Number
        },
        token: {
          type: String,
          value: document.querySelector('chulaexpo-staff-app').token
        },
        zones: {
          type: Array,
          value: [],
          notify: true,
        },
        fields: {
          type: String,
        },
        loading: Boolean,
        error: {
          type: Object,
          value: {}
        }
      },

      observers: [
        '_updateRequest(page, pageSize, fields)'
      ],

      _updateRequest: function(page, pageSize, fields) {
        this.set('params.limit', pageSize);
        this.set('params.skip', (page - 1) * pageSize);
        this.set('params.fields', fields)
      },
      generateRequest: function() {
         this.$.zoneResource.generateRequest();
      },
      _handleResponse: function(event) {
        if (event.detail.response.success) {
          this.zones = event.detail.response.results;
        } else {
          this.error = event.detail.response.errors;
        }
      }
    });
  </script>
</dom-module>
